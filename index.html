<!DOCTYPE html>
<html>
<head>
    <title>Arduino Driving Simulator</title>
    <style>
        body { text-align: center; background: #333; color: white; font-family: sans-serif; }
        #gameCanvas { background: #555; border: 5px solid #fff; margin-top: 20px; }
        .menu { margin: 20px; padding: 20px; border: 1px solid #777; }
    </style>
</head>
<body>
    <h1>ğŸš— ì•„ë‘ì´ë…¸ ìš´ì „ ë©´í—ˆ ì‹œí—˜ì¥</h1>

    <div class="menu">
        <button onclick="connectArduino()">1. ì•„ë‘ì´ë…¸ ì—°ê²°</button>
        <select id="carSelect">
            <option value="red">ìŠ¤í¬ì¸ ì¹´ (ë¹ ë¦„)</option>
            <option value="blue">íŠ¸ëŸ­ (ì•ˆì •ì )</option>
        </select>
        <button onclick="startExam()">2. ë©´í—ˆ ì‹œí—˜ ì‹œì‘</button>
    </div>

    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <p id="status">ìƒíƒœ: ëŒ€ê¸° ì¤‘...</p>

    <script>
        let car = { x: 100, y: 200, angle: 0, speed: 0, color: 'red' };
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ì•„ë‘ì´ë…¸ ë°ì´í„° ìˆ˜ì‹  ë³€ìˆ˜
        let wheelInput = 512; 
        let gasInput = 0;

        async function connectArduino() {
            try {
                const port = await navigator.serial.requestPort();
                await port.open({ baudRate: 9600 });
                document.getElementById('status').innerText = "ìƒíƒœ: ì•„ë‘ì´ë…¸ ì—°ê²°ë¨";
                
                const reader = port.readable.getReader();
                while (true) {
                    const { value, done } = await reader.read();
                    if (done) break;
                    const data = new TextDecoder().decode(value);
                    const values = data.split(',');
                    if(values.length === 2) {
                        wheelInput = parseInt(values[0]);
                        gasInput = parseInt(values[1]);
                    }
                }
            } catch (err) { console.error(err); }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ìë™ì°¨ ë¡œì§ ì—…ë°ì´íŠ¸
            if (gasInput === 1) car.speed = Math.min(car.speed + 0.2, 5);
            else car.speed = Math.max(car.speed - 0.1, 0);

            // í•¸ë“¤ ì¡°ì‘ (512ê°€ ì¤‘ì•™)
            let turnLimit = (wheelInput - 512) / 512;
            car.angle += turnLimit * 0.05;

            car.x += Math.cos(car.angle) * car.speed;
            car.y += Math.sin(car.angle) * car.speed;

            // ìë™ì°¨ ê·¸ë¦¬ê¸°
            ctx.save();
            ctx.translate(car.x, car.y);
            ctx.rotate(car.angle);
            ctx.fillStyle = document.getElementById('carSelect').value;
            ctx.fillRect(-20, -10, 40, 20);
            ctx.restore();

            requestAnimationFrame(draw);
        }

        function startExam() {
            document.getElementById('status').innerText = "ìƒíƒœ: ì‹œí—˜ ì§„í–‰ ì¤‘ (ì½”ìŠ¤ë¥¼ ì´íƒˆí•˜ì§€ ë§ˆì„¸ìš”!)";
            draw();
        }
    </script>
</body>
</html>
